/regimage { /tmp exch def
    << /Filename IMAGEDIR tmp ! (.pnm) ! >> (img:) tmp ! defimage
}def

/regimagedir{/DIR exch def [DIR(*.pnm)! {(.pnm) search{3 1 roll pop pop}{bug}ifelse DIR search{pop pop}{bug}ifelse ()!} 50 string filenameforall]{regimage}forall}def

IMAGEDIR regimagedir

/regimage { /tmp exch def
    << /Filename SHADOWDIR tmp ! (.pgm) ! >> (sdw:) tmp ! defimage
    << /Filename SHADOWDIR tmp ! (.pnm) ! /Alpha (sdw:) tmp ! >> (img:) tmp ! defimage
}def

SHADOWDIR regimagedir

<< /Filename BLASONDIR(templates/blason.pgm)! >> (sdw:blason) defimage
<< /Filename BLASONDIR(templates/protoblason.pgm)! >> (sdw:protoblason) defimage

/regimage {
    (shield_) anchorsearch {
        pop /pays exch def
    <<  /Filename BLASONDIR(shield_)! pays !(.pnm)!
	/Alpha (sdw:protoblason)>> (img:) (proto)pays ! ! defimage
    <<  /Filename BLASONDIR(shield_)! pays !(.pnm)!
	/Alpha (sdw:blason)>> (img:) pays ! defimage
    } {stopnow}ifelse
} def

BLASONDIR regimagedir
